<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Governance Control Explorer</title>
    <style>
        :root {
            --primary: #5b6cf3;
            --secondary: #8645ff;
            --bg: #f5f6fb;
            --text: #1f2346;
            --muted: #5a5f7d;
            --card-bg: rgba(255, 255, 255, 0.85);
            --border: rgba(120, 130, 180, 0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            font-family: 'Inter', 'Segoe UI', sans-serif;
            color: var(--text);
            background: linear-gradient(135deg, #eef2ff 0%, #f3e8ff 100%);
            padding: 48px 24px 64px;
        }

        .app-shell {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        header {
            text-align: center;
            color: var(--text);
        }

        header h1 {
            font-size: clamp(2rem, 2.6vw, 2.8rem);
            margin-bottom: 12px;
            font-weight: 700;
        }

        header p {
            color: var(--muted);
            max-width: 720px;
            margin: 0 auto;
            line-height: 1.6;
            font-size: 1rem;
        }

        .breadcrumbs {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            font-size: 0.95rem;
            color: var(--muted);
        }

        .breadcrumbs span {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(91, 108, 243, 0.1);
            color: var(--primary);
            font-weight: 600;
        }

        .breadcrumbs span.inactive {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--muted);
            font-weight: 500;
        }

        .layout {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 24px;
        }

        .column {
            background: var(--card-bg);
            border-radius: 22px;
            padding: 24px;
            box-shadow: 0 24px 60px rgba(75, 85, 172, 0.16);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            gap: 18px;
            border: 1px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .column:hover {
            transform: translateY(-4px);
            box-shadow: 0 32px 70px rgba(76, 85, 180, 0.18);
        }

        .column h2 {
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .column h2::before {
            content: attr(data-step);
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
            font-weight: 600;
        }

        .list {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .card {
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 18px;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            gap: 10px;
            cursor: pointer;
            transition: transform 0.25s ease, border 0.25s ease, box-shadow 0.25s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: rgba(91, 108, 243, 0.45);
            box-shadow: 0 14px 30px rgba(91, 108, 243, 0.18);
        }

        .card.selected {
            border: 2px solid transparent;
            background: linear-gradient(#fff, #fff) padding-box,
                        linear-gradient(135deg, var(--primary), var(--secondary)) border-box;
            box-shadow: 0 18px 40px rgba(91, 108, 243, 0.25);
        }

        .card h3 {
            font-size: 1.05rem;
            font-weight: 700;
        }

        .card p {
            color: var(--muted);
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .empty-state {
            border: 1px dashed var(--border);
            border-radius: 18px;
            padding: 30px;
            text-align: center;
            color: var(--muted);
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.65);
        }

        .controls-panel {
            background: var(--card-bg);
            border-radius: 22px;
            padding: 28px;
            box-shadow: 0 24px 60px rgba(91, 108, 243, 0.18);
            border: 1px solid var(--border);
            backdrop-filter: blur(8px);
            display: grid;
            gap: 24px;
        }

        .controls-panel header {
            text-align: left;
        }

        .controls-panel h2 {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .controls-panel p {
            color: var(--muted);
            line-height: 1.6;
        }

        .controls-grid {
            display: grid;
            gap: 18px;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        }

        .control-item {
            border-radius: 18px;
            padding: 18px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(91, 108, 243, 0.2);
            position: relative;
            overflow: hidden;
        }

        .control-item strong {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--primary);
        }

        .control-item::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            border: 1px solid transparent;
            background: linear-gradient(#fff, #fff) padding-box,
                        linear-gradient(135deg, rgba(91,108,243,0.4), rgba(134,69,255,0.4)) border-box;
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .control-item:hover::after {
            opacity: 1;
        }

        .tag-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tag {
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(91, 108, 243, 0.14);
            color: var(--primary);
            font-weight: 600;
            font-size: 0.85rem;
        }

        .hint {
            background: rgba(255, 215, 137, 0.28);
            color: #945c00;
            border-radius: 16px;
            padding: 16px 18px;
            font-size: 0.95rem;
            line-height: 1.5;
            border: 1px solid rgba(255, 188, 57, 0.32);
        }

        @media (max-width: 1080px) {
            .layout {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 32px 16px 48px;
            }

            .layout {
                grid-template-columns: 1fr;
            }

            .column {
                padding: 20px;
            }

            .controls-panel {
                padding: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="app-shell">
        <header>
            <h1>AI Governance Control Explorer</h1>
            <p>Navigate from industry to use case, explore the governing regulations, and review the key controls you must implement for compliant and trustworthy AI deployments.</p>
        </header>

        <nav class="breadcrumbs" aria-label="Workflow breadcrumbs">
            <span id="crumb-industry">1. Industry</span>
            <span id="crumb-usecase" class="inactive">2. Use Case</span>
            <span id="crumb-regulation" class="inactive">3. Regulation</span>
            <span id="crumb-controls" class="inactive">4. Controls</span>
        </nav>

        <section class="layout" aria-label="Selection panels">
            <article class="column" id="industryColumn">
                <h2 data-step="1">Select Industry</h2>
                <div id="industryList" class="list" role="list"></div>
            </article>

            <article class="column" id="useCaseColumn">
                <h2 data-step="2">Choose Use Case</h2>
                <div id="useCaseContent" class="list" role="list">
                    <div class="empty-state">Pick an industry to reveal its AI use cases.</div>
                </div>
            </article>

            <article class="column" id="regColumn">
                <h2 data-step="3">Review Regulations</h2>
                <div id="regContent" class="list" role="list">
                    <div class="empty-state">Select a use case to view relevant governance frameworks.</div>
                </div>
            </article>
        </section>

        <section class="controls-panel" aria-live="polite">
            <header>
                <h2 id="controlsTitle">Controls Overview</h2>
                <p id="controlsSubtitle">Start by selecting an industry and use case. We will surface the required controls for the applicable regulations.</p>
            </header>
            <div class="hint" id="hintBox" hidden></div>
            <div id="controlTags" class="tag-row"></div>
            <div id="controlsGrid" class="controls-grid"></div>
        </section>
    </div>

    <script>
        const governanceData = { industries: [] };

        Object.assign(governanceData, {
            industries: [
                {
                    id: 'healthcare',
                    name: 'Healthcare',
                    description: 'Medical diagnosis, treatment planning, patient care',
                    useCases: [
                        {
                            id: 'diagnostic_chatbot',
                            name: 'AI Diagnostic Chatbot',
                            description: 'Chatbot that provides preliminary medical diagnoses based on symptoms',
                            hint: 'Consider: health data regulations, patient privacy, and whether you have international users',
                            correctRegulations: ['gdpr', 'hipaa', 'eu_ai_act'],
                            regulations: {
                                gdpr: {
                                    reason: "If you have UK/EU patients, GDPR applies because you're processing personal health data",
                                    controls: ['Obtain explicit consent', 'Implement data minimization', 'Ensure right to explanation', 'Conduct DPIA']
                                },
                                hipaa: {
                                    reason: 'HIPAA applies to protected health information (PHI) in the US healthcare system',
                                    controls: ['Implement Business Associate Agreements', 'Ensure data encryption', 'Maintain audit logs', 'Provide breach notification']
                                },
                                eu_ai_act: {
                                    reason: 'Healthcare AI systems are classified as high-risk under the EU AI Act',
                                    controls: ['Risk management system', 'High-quality training data', 'Technical documentation', 'Human oversight']
                                }
                            }
                        },
                        {
                            id: 'patient_monitoring',
                            name: 'Remote Patient Monitoring',
                            description: 'AI system monitoring patient vitals and alerting healthcare providers',
                            hint: 'This is a safety-critical medical device with continuous data collection',
                            correctRegulations: ['gdpr', 'hipaa', 'eu_ai_act', 'fda'],
                            regulations: {
                                gdpr: {
                                    reason: 'Continuous collection of personal health data requires GDPR compliance',
                                    controls: ['Data protection by design', 'Regular security assessments', 'Patient consent management']
                                },
                                hipaa: {
                                    reason: 'Monitoring systems handling PHI must be HIPAA compliant',
                                    controls: ['Secure data transmission', 'Access controls', 'Emergency access procedures']
                                },
                                eu_ai_act: {
                                    reason: 'Safety component in medical devices - high-risk classification',
                                    controls: ['Conformity assessment', 'Post-market monitoring', 'Incident reporting']
                                },
                                fda: {
                                    reason: 'Medical device that makes clinical decisions requires FDA clearance',
                                    controls: ['Clinical validation studies', 'Software updates protocol', 'Quality management system']
                                }
                            }
                        }
                    ]
                },
                {
                    id: 'finance',
                    name: 'Financial Services',
                    description: 'Banking, lending, investment, insurance',
                    useCases: [
                        {
                            id: 'credit_scoring',
                            name: 'AI Credit Scoring System',
                            description: 'Automated system for evaluating loan applications and creditworthiness',
                            hint: 'Think about fair lending laws and consumer rights to explanation',
                            correctRegulations: ['gdpr', 'ecoa', 'eu_ai_act', 'fcra'],
                            regulations: {
                                gdpr: {
                                    reason: 'Credit decisions based on personal data require GDPR compliance and right to explanation',
                                    controls: ['Automated decision-making safeguards', 'Transparency about logic', 'Right to human review']
                                },
                                ecoa: {
                                    reason: 'Equal Credit Opportunity Act prohibits discrimination in credit decisions',
                                    controls: ['Bias testing across protected classes', 'Adverse action notices', 'Documentation of decision factors']
                                },
                                eu_ai_act: {
                                    reason: 'Credit scoring is explicitly listed as high-risk under the EU AI Act',
                                    controls: ['Algorithmic impact assessment', 'Regular bias audits', 'Model documentation']
                                },
                                fcra: {
                                    reason: 'Fair Credit Reporting Act governs use of consumer data in credit decisions',
                                    controls: ['Accuracy requirements', 'Dispute resolution process', 'Consumer notification']
                                }
                            }
                        },
                        {
                            id: 'fraud_detection',
                            name: 'Fraud Detection System',
                            description: 'Real-time AI monitoring for fraudulent transactions',
                            hint: 'Consider data protection, but also false positive impacts on customers',
                            correctRegulations: ['gdpr', 'pci_dss', 'eu_ai_act'],
                            regulations: {
                                gdpr: {
                                    reason: 'Processing personal financial data for fraud prevention requires lawful basis',
                                    controls: ['Legitimate interest assessment', 'Data retention limits', 'Proportionality checks']
                                },
                                pci_dss: {
                                    reason: 'Payment card data security standards apply to transaction monitoring',
                                    controls: ['Secure data handling', 'Network segmentation', 'Regular security testing']
                                },
                                eu_ai_act: {
                                    reason: 'Automated decisions affecting access to financial services are high-risk',
                                    controls: ['Human oversight for account freezing', 'Audit trails', 'Appeal mechanisms']
                                }
                            }
                        }
                    ]
                },
                {
                    id: 'employment',
                    name: 'Human Resources',
                    description: 'Recruitment, hiring, performance management',
                    useCases: [
                        {
                            id: 'resume_screening',
                            name: 'AI Resume Screening Tool',
                            description: 'Automated system ranking candidates and filtering applications',
                            hint: 'Employment decisions have strict anti-discrimination requirements in many jurisdictions',
                            correctRegulations: ['gdpr', 'title_vii', 'eu_ai_act', 'nyc_law_144'],
                            regulations: {
                                gdpr: {
                                    reason: 'Processing personal data for hiring requires transparency and fairness',
                                    controls: ['Candidate notification', 'Data minimization', 'Retention policies']
                                },
                                title_vii: {
                                    reason: 'Civil Rights Act prohibits employment discrimination based on protected characteristics',
                                    controls: ['Disparate impact analysis', 'Regular bias testing', 'Documentation of validation studies']
                                },
                                eu_ai_act: {
                                    reason: 'Employment and worker management explicitly designated as high-risk',
                                    controls: ['Impact assessment', 'Human reviewers for final decisions', 'Contestability mechanisms']
                                },
                                nyc_law_144: {
                                    reason: 'NYC requires bias audits for automated employment decision tools',
                                    controls: ['Annual independent audit', 'Public disclosure of results', 'Candidate notification']
                                }
                            }
                        },
                        {
                            id: 'performance_monitoring',
                            name: 'Employee Performance AI',
                            description: 'System monitoring productivity and generating performance scores',
                            hint: 'Worker surveillance has privacy implications and employment law considerations',
                            correctRegulations: ['gdpr', 'title_vii', 'eu_ai_act', 'nlra'],
                            regulations: {
                                gdpr: {
                                    reason: 'Continuous employee monitoring requires clear legal basis and proportionality',
                                    controls: ['Employee consent or legitimate interest', 'Transparency about metrics', 'Limited data retention']
                                },
                                title_vii: {
                                    reason: 'Performance systems must not discriminate against protected classes',
                                    controls: ['Validation across demographics', 'Appeals process', 'Reasonable accommodations']
                                },
                                eu_ai_act: {
                                    reason: 'AI systems influencing employment terms and conditions are high-risk',
                                    controls: ['Worker consultation', 'Right to explanation', 'Human oversight']
                                },
                                nlra: {
                                    reason: "National Labor Relations Act protects workers' right to organize",
                                    controls: ['Bargaining over monitoring introduction', 'No chilling effect on protected activities']
                                }
                            }
                        }
                    ]
                },
                {
                    id: 'retail',
                    name: 'E-Commerce & Retail',
                    description: 'Online shopping, recommendations, customer service',
                    useCases: [
                        {
                            id: 'recommendation_engine',
                            name: 'Product Recommendation AI',
                            description: 'Personalized product suggestions for international customers',
                            hint: 'Consider privacy laws and algorithmic transparency for recommendations',
                            correctRegulations: ['gdpr', 'ccpa', 'china_algo'],
                            regulations: {
                                gdpr: {
                                    reason: 'Profiling EU customers for recommendations requires consent or legitimate interest',
                                    controls: ['Cookie consent', 'Easy opt-out', 'Right to data portability']
                                },
                                ccpa: {
                                    reason: 'California consumers have right to opt-out of personal data sales/sharing',
                                    controls: ['Clear opt-out mechanism', 'Do Not Sell My Personal Information link', 'Non-discrimination']
                                },
                                china_algo: {
                                    reason: 'China requires transparency in algorithmic recommendations and user choice',
                                    controls: ['Algorithm filing with CAC', 'User option to disable personalization', 'Mainstream values compliance']
                                }
                            }
                        },
                        {
                            id: 'chatbot_support',
                            name: 'Customer Service Chatbot',
                            description: 'AI chatbot handling customer inquiries and returns',
                            hint: "Chatbots must disclose they're AI in many jurisdictions",
                            correctRegulations: ['gdpr', 'ccpa', 'eu_ai_act'],
                            regulations: {
                                gdpr: {
                                    reason: 'Customer conversations contain personal data requiring protection',
                                    controls: ['Data encryption', 'Limited retention', 'Secure processing']
                                },
                                ccpa: {
                                    reason: "California customers' data from chatbots has privacy protections",
                                    controls: ['Privacy notice', 'Data access requests', 'Deletion rights']
                                },
                                eu_ai_act: {
                                    reason: 'Chatbots must disclose they are AI systems to users',
                                    controls: ['Clear AI disclosure', 'Human escalation option', 'Transparency about limitations']
                                }
                            }
                        }
                    ]
                },
                {
                    id: 'education',
                    name: 'Education Technology',
                    description: 'Online learning, student assessment, tutoring',
                    useCases: [
                        {
                            id: 'adaptive_learning',
                            name: 'Adaptive Learning Platform',
                            description: 'AI system personalizing education content for K-12 students',
                            hint: "Children's data has special protections, and educational decisions are sensitive",
                            correctRegulations: ['gdpr', 'coppa', 'ferpa', 'eu_ai_act'],
                            regulations: {
                                gdpr: {
                                    reason: "Children's personal data requires enhanced protection under GDPR",
                                    controls: ['Parental consent under age 16', 'Age verification', 'Child-appropriate privacy notices']
                                },
                                coppa: {
                                    reason: "Children's Online Privacy Protection Act applies to US users under 13",
                                    controls: ['Verifiable parental consent', 'No behavioral advertising to children', 'Data minimization']
                                },
                                ferpa: {
                                    reason: 'Family Educational Rights and Privacy Act protects student education records',
                                    controls: ['School authorization', 'Limited disclosure', 'Parent access rights']
                                },
                                eu_ai_act: {
                                    reason: 'AI determining educational outcomes is high-risk',
                                    controls: ['Bias prevention', 'Human teacher oversight', 'No manipulation of vulnerable users']
                                }
                            }
                        },
                        {
                            id: 'proctoring',
                            name: 'AI Exam Proctoring',
                            description: 'Automated monitoring system detecting cheating in online exams',
                            hint: 'Biometric surveillance in education raises privacy and fairness concerns',
                            correctRegulations: ['gdpr', 'ferpa', 'eu_ai_act', 'ada'],
                            regulations: {
                                gdpr: {
                                    reason: 'Facial recognition and behavior monitoring are special category processing',
                                    controls: ['Explicit consent', 'DPIA required', 'Strict purpose limitation']
                                },
                                ferpa: {
                                    reason: 'Proctoring data becomes part of education records',
                                    controls: ['Student/parent notification', 'Secure storage', 'Limited retention']
                                },
                                eu_ai_act: {
                                    reason: 'Remote biometric identification has strict restrictions; educational AI is high-risk',
                                    controls: ['Minimize biometric data collection', 'Human review of flags', 'Contestability']
                                },
                                ada: {
                                    reason: 'Americans with Disabilities Act requires accommodations',
                                    controls: ['Alternative testing methods', 'Reasonable accommodations', 'No discrimination']
                                }
                            }
                        }
                    ]
                }
            ],
            allRegulations: {
                gdpr: {
                    name: 'GDPR (EU/UK)',
                    description: "General Data Protection Regulation - applies when processing EU/UK residents' personal data"
                },
                hipaa: {
                    name: 'HIPAA (US)',
                    description: 'Health Insurance Portability and Accountability Act - protects health information in the US'
                },
                eu_ai_act: {
                    name: 'EU AI Act',
                    description: 'Risk-based AI regulation with requirements for high-risk systems'
                },
                fda: {
                    name: 'FDA Regulations (US)',
                    description: 'Food and Drug Administration oversight of medical devices including AI/ML'
                },
                ecoa: {
                    name: 'ECOA (US)',
                    description: 'Equal Credit Opportunity Act - prohibits credit discrimination'
                },
                fcra: {
                    name: 'FCRA (US)',
                    description: 'Fair Credit Reporting Act - governs consumer credit information'
                },
                pci_dss: {
                    name: 'PCI DSS',
                    description: 'Payment Card Industry Data Security Standard'
                },
                title_vii: {
                    name: 'Title VII (US)',
                    description: 'Civil Rights Act - prohibits employment discrimination'
                },
                nyc_law_144: {
                    name: 'NYC Local Law 144',
                    description: 'Requires bias audits for automated employment decision tools in NYC'
                },
                nlra: {
                    name: 'NLRA (US)',
                    description: "National Labor Relations Act - protects workers' rights"
                },
                ccpa: {
                    name: 'CCPA/CPRA (California)',
                    description: 'California Consumer Privacy Act - comprehensive privacy rights'
                },
                china_algo: {
                    name: 'China Algorithm Regulations',
                    description: 'Provisions on algorithmic recommendations and content regulation'
                },
                coppa: {
                    name: 'COPPA (US)',
                    description: "Children's Online Privacy Protection Act"
                },
                ferpa: {
                    name: 'FERPA (US)',
                    description: 'Family Educational Rights and Privacy Act'
                },
                ada: {
                    name: 'ADA (US)',
                    description: 'Americans with Disabilities Act - requires accessibility and accommodations'
                }
            }
        });

        let selectedIndustryId = null;
        let selectedUseCaseId = null;
        let selectedRegulationId = null;

        const industryList = document.getElementById('industryList');
        const useCaseContent = document.getElementById('useCaseContent');
        const regContent = document.getElementById('regContent');
        const controlsTitle = document.getElementById('controlsTitle');
        const controlsSubtitle = document.getElementById('controlsSubtitle');
        const controlsGrid = document.getElementById('controlsGrid');
        const controlTags = document.getElementById('controlTags');
        const hintBox = document.getElementById('hintBox');

        const crumbIndustry = document.getElementById('crumb-industry');
        const crumbUseCase = document.getElementById('crumb-usecase');
        const crumbRegulation = document.getElementById('crumb-regulation');
        const crumbControls = document.getElementById('crumb-controls');

        function renderIndustries() {
            const fragment = document.createDocumentFragment();
            governanceData.industries.forEach(industry => {
                const card = document.createElement('button');
                card.type = 'button';
                card.className = 'card';
                card.setAttribute('data-id', industry.id);
                card.innerHTML = `
                    <h3>${industry.name}</h3>
                    <p>${industry.description}</p>
                `;
                card.addEventListener('click', () => selectIndustry(industry.id));
                fragment.appendChild(card);
            });
            industryList.innerHTML = '';
            industryList.appendChild(fragment);
        }

        function selectIndustry(industryId) {
            if (selectedIndustryId === industryId) return;
            selectedIndustryId = industryId;
            selectedUseCaseId = null;
            selectedRegulationId = null;

            updateCardSelection(industryList, industryId);
            updateBreadcrumbs();
            renderUseCases();
            renderRegulations();
            renderControls();
        }

        function renderUseCases() {
            useCaseContent.innerHTML = '';
            if (!selectedIndustryId) {
                useCaseContent.innerHTML = '<div class="empty-state">Pick an industry to reveal its AI use cases.</div>';
                return;
            }

            const industry = governanceData.industries.find(item => item.id === selectedIndustryId);
            const fragment = document.createDocumentFragment();

            industry.useCases.forEach(useCase => {
                const card = document.createElement('button');
                card.type = 'button';
                card.className = 'card';
                card.setAttribute('data-id', useCase.id);
                card.innerHTML = `
                    <div class="tag-row">
                        <span class="tag">${industry.name}</span>
                    </div>
                    <h3>${useCase.name}</h3>
                    <p>${useCase.description}</p>
                `;
                card.addEventListener('click', () => selectUseCase(useCase.id));
                fragment.appendChild(card);
            });

            useCaseContent.appendChild(fragment);
        }

        function selectUseCase(useCaseId) {
            if (selectedUseCaseId === useCaseId) return;
            selectedUseCaseId = useCaseId;
            selectedRegulationId = null;

            updateCardSelection(useCaseContent, useCaseId);
            updateBreadcrumbs();
            renderRegulations();
            renderControls();
        }

        function renderRegulations() {
            regContent.innerHTML = '';
            if (!selectedIndustryId || !selectedUseCaseId) {
                regContent.innerHTML = '<div class="empty-state">Select a use case to view relevant governance frameworks.</div>';
                return;
            }

            const { useCase, industry } = getCurrentContext();
            const fragment = document.createDocumentFragment();

            useCase.correctRegulations.forEach(regId => {
                const regulation = governanceData.allRegulations[regId];
                const card = document.createElement('button');
                card.type = 'button';
                card.className = 'card';
                card.setAttribute('data-id', regId);
                card.innerHTML = `
                    <div class="tag-row">
                        <span class="tag">${industry.name}</span>
                        <span class="tag">${useCase.name}</span>
                    </div>
                    <h3>${regulation.name}</h3>
                    <p>${regulation.description}</p>
                `;
                card.addEventListener('click', () => selectRegulation(regId));
                fragment.appendChild(card);
            });

            regContent.appendChild(fragment);
        }

        function selectRegulation(regulationId) {
            selectedRegulationId = regulationId;
            updateCardSelection(regContent, regulationId);
            updateBreadcrumbs();
            renderControls();
        }

        function renderControls() {
            const context = getCurrentContext();

            if (!context) {
                controlsTitle.textContent = 'Controls Overview';
                controlsSubtitle.textContent = 'Start by selecting an industry and use case. We will surface the required controls for the applicable regulations.';
                controlsGrid.innerHTML = '';
                controlTags.innerHTML = '';
                hintBox.hidden = true;
                return;
            }

            const { industry, useCase } = context;
            controlsTitle.textContent = `${industry.name} · ${useCase.name}`;
            controlsSubtitle.textContent = 'Review the governance drivers and implement the required controls for a compliant deployment.';
            hintBox.textContent = useCase.hint;
            hintBox.hidden = false;

            controlTags.innerHTML = '';
            useCase.correctRegulations.forEach(regId => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = governanceData.allRegulations[regId].name;
                controlTags.appendChild(tag);
            });

            const gridFragment = document.createDocumentFragment();

            const regulationsToRender = selectedRegulationId
                ? [selectedRegulationId]
                : useCase.correctRegulations;

            regulationsToRender.forEach(regId => {
                const reg = governanceData.allRegulations[regId];
                const details = useCase.regulations[regId];

                const item = document.createElement('article');
                item.className = 'control-item';
                item.innerHTML = `
                    <strong>${reg.name}</strong>
                    <p><em>${details.reason}</em></p>
                    <ul>
                        ${details.controls.map(control => `<li>${control}</li>`).join('')}
                    </ul>
                `;
                gridFragment.appendChild(item);
            });

            controlsGrid.innerHTML = '';
            controlsGrid.appendChild(gridFragment);
        }

        function getCurrentContext() {
            if (!selectedIndustryId) return null;
            const industry = governanceData.industries.find(item => item.id === selectedIndustryId);
            if (!industry || !selectedUseCaseId) return { industry };
            const useCase = industry.useCases.find(item => item.id === selectedUseCaseId);
            if (!useCase) return { industry };
            return { industry, useCase };
        }

        function updateCardSelection(container, id) {
            Array.from(container.querySelectorAll('.card')).forEach(card => {
                if (card.getAttribute('data-id') === id) {
                    card.classList.add('selected');
                    card.setAttribute('aria-pressed', 'true');
                } else {
                    card.classList.remove('selected');
                    card.setAttribute('aria-pressed', 'false');
                }
            });
        }

        function updateBreadcrumbs() {
            crumbIndustry.classList.toggle('inactive', !selectedIndustryId);
            crumbIndustry.textContent = selectedIndustryId ? `1. Industry · ${lookupIndustryName(selectedIndustryId)}` : '1. Industry';

            const useCaseName = selectedUseCaseId ? lookupUseCaseName(selectedUseCaseId) : null;
            crumbUseCase.classList.toggle('inactive', !useCaseName);
            crumbUseCase.textContent = useCaseName ? `2. Use Case · ${useCaseName}` : '2. Use Case';

            const regulationName = selectedRegulationId ? governanceData.allRegulations[selectedRegulationId].name : null;
            crumbRegulation.classList.toggle('inactive', !regulationName);
            crumbRegulation.textContent = regulationName ? `3. Regulation · ${regulationName}` : '3. Regulation';

            const hasControls = Boolean(selectedIndustryId && selectedUseCaseId);
            crumbControls.classList.toggle('inactive', !hasControls);
            crumbControls.textContent = hasControls ? '4. Controls · Ready' : '4. Controls';
        }

        function lookupIndustryName(id) {
            const industry = governanceData.industries.find(item => item.id === id);
            return industry ? industry.name : '';
        }

        function lookupUseCaseName(id) {
            for (const industry of governanceData.industries) {
                const found = industry.useCases.find(useCase => useCase.id === id);
                if (found) return found.name;
            }
            return '';
        }

        renderIndustries();
        updateBreadcrumbs();
    </script>
</body>
</html>
